
<%- include('../partials/header.ejs') %>
<div class="colorlib-product">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="country">Select Address</label>
                        <div class="form-field">
                            <i class="icon icon-arrow-down3"></i>
                            <select name="country" id="country" class="form-control">
                                <option value="#">Select Address</option>
                                <% if (addresses && addresses.length > 0) { %>
                                    <% addresses.forEach(address => { %>
                                        <option value="<%= address._id %>">
                                            <%= address.full_name %> - <%= address.street_address %>, <%= address.city %>, <%= address.state %> - <%= address.pincode %>, <%= address.country %>
                                        </option>
                                    <% }) %>
                                <% } else { %>
                                    <option value="">No addresses found</option>
                                <% } %>
                            </select>
                        </div>
                    </div>
                </div>
                        
                <form  method="POST" class="colorlib-form">
                    <h2>Billing Details</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="fname">Full Name</label>
                                <input type="text" id="fname" class="form-control" placeholder="Your firstname">
                            </div>
                        </div>
                    
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" id="address" class="form-control" placeholder="Enter Your Address">
                            </div>
                        </div>
                    
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="country">Country</label>
                                    <input type="text" name="country" id="country" class="form-control" placeholder="Country">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="towncity">City</label>
                                    <input type="text" id="towncity" class="form-control" placeholder="City">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="stateprovince">State</label>
                                <input type="text" id="stateprovince" class="form-control" placeholder="State ">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="zippostalcode">ZipCode</label>
                                <input type="text" id="zippostalcode" class="form-control" placeholder="ZipCode">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="email">E-mail Address</label>
                                <input type="text" id="email" class="form-control" placeholder="Email">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="text" id="phone" class="form-control" placeholder="Phone Number">
                            </div>
                        </div>
                    </div>
                        <button class="btn btn-primary btn-addtocart" onclick="createAddress()">create</button>
                        
                    </div>
                </form>
            </div>

            <div class="col-lg-4">
                <div class="row">
                    <div class="col-md-12">
                        <div class="cart-detail">
                            <h2>Cart Total</h2>
                            <ul>
                                <li>
                                    <span>Subtotal</span> <span>$<%= cart.total_price %></span>
                                    
                                </li>
                                <li><span>Shipping</span> <span>$0.00</span></li>
                                <li><span>Order Total</span> <span>$<%= cart.total_price %></span></li>
                            </ul>
                        </div>
                   </div>

                   <div class="w-100"></div>

                   <div class="col-md-12">
                        <div class="cart-detail">
                            <h2>Payment Method</h2>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="radio">
                                       <label><input type="radio" name="optradio">Bank Tranfer</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="radio">
                                       <label><input type="radio" name="optradio">Cash on delivery</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="checkbox">
                                       <label><input type="checkbox" value=""> I have read and accept the terms and conditions</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-center">
                        <p><a href="#" class="btn btn-primary">Place an order</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function createAddress() {
        const fullName = document.getElementById('fname').value;
        const address = document.getElementById('address').value;
        const city = document.getElementById('towncity').value;
        const state = document.getElementById('stateprovince').value;
        const zipcode = document.getElementById('zippostalcode').value;
        const phone = document.getElementById('phone').value;
        const country = document.getElementById('country').value;
        const email = document.getElementById('email').value;

        if (!fullName || !address || !city || !state || !zipcode || !phone || !country || !email) {
            Swal.fire({
                title: "Error!",
                text: "please enter all field",
                icon: "error",
                timer: 1500,
                showConfirmButton: false
            });
            return
        }
        const userId = "<%= userId %>"
        const data = {
            full_name: fullName,
            street_address: address,
            pincode: zipcode,
            city: city,
            phone: phone,
            country: country,
            state: state,
            user_id:userId  
        };

        fetch('/address/add-address', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert(data.message);
            } else {
                Swal.fire({
                title: "Success",
                text: "Address added successfully",
                icon: "success",
                timer: 1500,
                showConfirmButton: false
            });
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            Swal.fire({
                title: "Error!",
                text: "Please try again later",
                icon: "error",
                timer: 1500,
                showConfirmButton: false
            });
        });
    }
</script>
<%- include('../partials/footer.ejs') %>