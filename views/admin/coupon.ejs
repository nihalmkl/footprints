
    <style>
        body {
            background-color: #f4f7f9;
        }
        h2 {
            color: #333;
        }
        .table {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .btn {
            border-radius: 30px;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }
        .btn-add {
            float: right;
            border-radius: 30px;
        }
        .modal-header {
            background-color: #007bff;
            color: white;
        }
        .modal-footer .btn {
            border-radius: 30px;
        }
        .status-active {
            color: green;
            font-weight: bold;
        }
        .status-expired {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <button class="btn btn-success btn-add mb-3" data-toggle="modal" data-target="#addCouponModal">Add Coupon</button>
        
        <table class="table table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Coupon Code</th>
                    <th>Discount(%)</th>
                    <th>Start</th>
                    <th>Expiry</th>
                    <th>Minimum Purchase</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% coupons.forEach(function(coupon) { %>
                <tr>
                    <td><%= coupon.coupon_code %></td>
                    <td><%= coupon.discount %>%</td>
                    <td><%= new Date(coupon.start_date).toLocaleDateString() %></td>
                    <td><%= new Date(coupon.expiry_date).toLocaleDateString() %></td>
                    <td>$<%= coupon.min_pur_amount.toFixed(2) %></td>
                    <td><%= coupon.description %></td>
                    <td class="<%= new Date(coupon.expiry_date) > new Date() ? 'status-active' : 'status-expired' %>">
                        <%= new Date(coupon.expiry_date) > new Date() ? 'Active' : 'Expired' %>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editCouponModal<%= coupon._id %>">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCoupon('<%= coupon._id %>')">Delete</button>
                    </td>
                </tr>
 
                <div class="modal fade" id="editCouponModal<%= coupon._id %>" tabindex="-1" aria-labelledby="editCouponModalLabel<%= coupon._id %>" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editCouponModalLabel<%= coupon._id %>">Edit Coupon</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form action="/coupons/<%= coupon._id %>?_method=PUT" method="POST">
                          <div class="form-group">
                            <label for="editCouponCode">Coupon Code</label>
                            <input type="text" class="form-control" id="editCouponCode" name="coupon_code" value="<%= coupon.coupon_code %>" required>
                          </div>
                          <div class="form-group">
                            <label for="editDiscountPercentage">Discount(%)</label>
                            <input type="text" class="form-control" id="editDiscountPercentage" name="discount" value="<%= coupon.discount %>" required>
                          </div>
                          <div class="form-group">
                            <label for="editStartDate">Start Date</label>
                            <input type="date" class="form-control" id="editStartDate" name="start_date" value="<%= coupon.start_date.toISOString().split('T')[0] %>" required>
                          </div>
                          <div class="form-group">
                            <label for="editExpiryDate">Expiry Date</label>
                            <input type="date" class="form-control" id="editExpiryDate" name="expiry_date" value="<%= coupon.expiry_date.toISOString().split('T')[0] %>" required>
                          </div>
                          <div class="form-group">
                            <label for="editMinPurchasePrice">MinimumPurchase</label>
                            <input type="number" class="form-control" id="editMinPurchasePrice" name="min_pur_amount" value="<%= coupon.min_pur_amount %>" required>
                          </div>
                          <div class="form-group">
                            <label for="editCouponDescription">Description</label>
                            <textarea class="form-control" id="editCouponDescription" name="description" rows="3" required><%= coupon.description %></textarea>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save changes</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                <% }) %>
            </tbody>
        </table>
    </div>

    <div class="modal fade" id="addCouponModal" tabindex="-1" aria-labelledby="addCouponModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="addCouponModalLabel">New Coupon</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  <form id="addCouponForm" action="/coupons" method="POST">
                      <div class="form-group">
                          <label for="couponCode">Coupon Code</label>
                          <input type="text" class="form-control" id="couponCode" name="coupon_code" required>
                      </div>
                      <div class="form-group">
                          <label for="discountPercentage">Discount(%)</label>
                          <input type="text" class="form-control" id="discountPercentage" name="discount" required>
                      </div>
                      <div class="form-group">
                          <label for="startDate">Start Date</label>
                          <input type="date" class="form-control" id="startDate" name="start_date" required>
                      </div>
                      <div class="form-group">
                          <label for="expiryDate">Expiry Date</label>
                          <input type="date" class="form-control" id="expiryDate" name="expiry_date" required>
                      </div>
                      <div class="form-group">
                          <label for="minPurchasePrice">Minimum Purchase</label>
                          <input type="number" class="form-control" id="minPurchasePrice" name="min_pur_amount" required>
                      </div>
                      <div class="form-group">
                          <label for="couponDescription">Description</label>
                          <textarea class="form-control" id="couponDescription" name="description" rows="3" required></textarea>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          <button type="submit" class="btn btn-success">Add Coupon</button>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <script>
    async function addCoupon(event) {
        event.preventDefault()
        const form = document.getElementById('addCouponForm')
        const formData = new FormData(form)

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData
            })
            const result = await response.json()

            if (result.success) {
                Swal.fire('Success', 'Coupon added successfully!', 'success')
                location.reload()
            } else {
                Swal.fire('Error', result.message, 'error')
            }
        } catch (error) {
            console.error('Error:', error)
            Swal.fire('Error', 'An error occurred while adding the coupon.', 'error')
        }
    }

    document.getElementById('addCouponForm').addEventListener('submit', addCoupon)

async function editCoupon(id) {
    const form = document.getElementById(`editCouponForm${id}`)
    const formData = new FormData(form)

    try {
        const response = await fetch(`/coupons/${id}`, {
            method: 'PUT',
            body: formData
        })
        const result = await response.json()

        if (result.success) {
            Swal.fire('Success', 'Coupon updated successfully!', 'success')
            location.reload()
        } else {
            Swal.fire('Error', result.message, 'error')
        }
    } catch (error) {
        console.error('Error:', error)
        Swal.fire('Error', 'An error occurred while updating the coupon.', 'error')
    }
}

async function deleteCoupon(id) {
    const confirmDelete = confirm('Are you sure you want to delete this coupon?')
    if (confirmDelete) {
        try {
            const response = await fetch(`/coupons/${id}`, {
                method: 'DELETE'
            })
            const result = await response.json()

            if (result.success) {
                Swal.fire('Deleted!', 'Coupon has been deleted.', 'success')
                location.reload()
            } else {
                Swal.fire('Error', result.message, 'error')
            }
        } catch (error) {
            console.error('Error:', error)
            Swal.fire('Error', 'An error occurred while deleting the coupon.', 'error')
        }
    }
}
</script>
